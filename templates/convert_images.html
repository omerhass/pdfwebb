{% extends "base.html" %}
{% set active = 'img2pdf' %}

{% block extra_css %}
<style>
  .perk{
    padding:10px 12px; border:1px solid var(--border);
    border-radius:12px; background:#fff;
  }
  .qa{
    border:1px solid var(--border); border-radius:12px;
    padding:10px 12px; background:#fff; margin-top:10px;
  }
  .qa summary{ cursor:pointer; font-weight:600 }
  .qa[open]{ box-shadow:0 0 0 4px var(--ring) }
</style>
{% endblock %}

{% block content %}

<section class="hero">
  <div class="container">
    <div class="grid">

      <!-- ✅ اليسار — أداة تحويل الصور -->
      <div class="card">
        <h1 style="margin:6px 0 6px" data-i18n="img2pdf_title">صور إلى PDF</h1>
        <p class="sub" style="margin:0 0 14px" data-i18n="img2pdf_subtitle">
          ادمج صورك بصفحات أنيقة للجوال أو اختر A4 للطباعة.
        </p>

        <form id="imgForm" action="/api/images-to-pdf" method="post" enctype="multipart/form-data"
              style="display:flex;flex-direction:column;gap:14px">

          <!-- نرسل لغة الواجهة للباكند -->
          <input type="hidden" name="lang" id="imgLang">

          <input id="imgs" type="file" name="images" accept="image/*" multiple hidden />

          <div style="text-align:center">
            <button type="button" id="pickImg" class="btn" data-i18n="img2pdf_choose_images">اختر الصور</button>
            <div class="sub" data-i18n="img2pdf_or_drag_here">أو اسحبها هنا</div>
          </div>

          <div id="imgDrop" class="drop" data-i18n="img2pdf_drop_here">اسحب الصور هنا</div>

          <div class="row">
            <input type="text" name="outfile" value="images.pdf" placeholder="اسم ملف PDF (للدمج)">
            <select name="order" title="ترتيب">
              <option value="name"  data-i18n="img2pdf_order_name">حسب الاسم</option>
              <option value="mtime" data-i18n="img2pdf_order_mtime">حسب تاريخ التعديل</option>
              <option value="as_is" data-i18n="img2pdf_order_as_is">كما تم اختيارها</option>
            </select>
          </div>

          <div class="row">
            <label class="chip">
              <input type="checkbox" name="per_file" value="1">
              <span data-i18n="img2pdf_per_file">ملف لكل صورة</span>
            </label>
            <label class="chip">
              <input type="checkbox" name="compress" value="1">
              <span data-i18n="img2pdf_light_compress">ضغط خفيف</span>
            </label>
          </div>

          <div class="row">
            <span class="sub" style="align-self:center" data-i18n="img2pdf_layout_label">النمط:</span>
            <label class="chip">
              <input type="radio" name="style" value="full_bleed" checked>
              <span data-i18n="img2pdf_style_full_bleed">بدون حواف</span>
            </label>
            <label class="chip">
              <input type="radio" name="style" value="a4_margins">
              <span data-i18n="img2pdf_style_a4">A4 للطباعة</span>
            </label>
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button type="submit" class="btn" data-i18n="img2pdf_convert_now">حوّل الآن</button>
            <a class="btn muted" href="/merge/pdf" data-i18n="img2pdf_go_merge">انتقال لدمج PDF</a>
          </div>

          <div id="imgCount" class="sub" data-i18n="img2pdf_no_images">لا توجد صور محددة</div>
        </form>
      </div>

      <!-- ✅ اليمين — نصائح -->
      <div class="card" style="align-self:start">
        <h3 style="margin:6px 0 12px" data-i18n="tips_title">نصائح</h3>
        <ul style="margin:0;padding:0 18px;line-height:1.9">
          <li data-i18n="tips_item1">اختر <b>بدون حواف</b> لنتيجة ممتازة للجوال.</li>
          <li data-i18n="tips_item2">لطباعة احترافية استخدم <b>A4</b>.</li>
          <li data-i18n="tips_item3">فعّل <b>الضغط الخفيف</b> لتقليل الحجم.</li>
        </ul>
      </div>

    </div>
  </div>
</section>


<!-- ✅ قسم المزايا + الأسئلة الشائعة -->
<section>
  <div class="container" style="margin-top:18px;display:grid;gap:18px">

    <!-- ✅ مزايا -->
    <div class="card">
      <h2 style="margin:0 0 6px" data-i18n="features_title">مزايا الموقع</h2>
      <div class="row" style="margin-top:8px">
        <div class="perk" data-i18n="feature_ui_arabic">✅ واجهة عربية سهلة</div>
        <div class="perk" data-i18n="feature_mobile_ready">✅ مناسب للجوال</div>
        <div class="perk" data-i18n="feature_no_storage">✅ معالجة فورية — بدون حفظ</div>
      </div>
    </div>

    <!-- ✅ الأسئلة الشائعة -->
    <div class="card">
      <h2 style="margin:0 0 6px" data-i18n="faq_title">الأسئلة الشائعة</h2>

      <details class="qa">
        <summary data-i18n="faq_q1">هل تحفظون ملفاتي؟</summary>
        <div data-i18n="faq_a1">لا يتم حفظ أي ملف، تتم المعالجة أثناء الجلسة فقط.</div>
      </details>

      <details class="qa">
        <summary data-i18n="faq_q2">أفضل إعداد للطباعة؟</summary>
        <div data-i18n="faq_a2">اختر نمط A4 مع هوامش، وقد تعطّل الضغط للحفاظ على الدقة.</div>
      </details>

      <details class="qa">
        <summary data-i18n="faq_q3">الملف كبير بعد التحويل؟</summary>
        <div data-i18n="faq_a3">فعّل خيار الضغط الخفيف، أو استخدم صفحة ضغط PDF.</div>
      </details>
    </div>

  </div>
</section>

{% endblock %}


{% block extra_js %}
<script>
  const imgs     = document.getElementById('imgs');
  const pickImg  = document.getElementById('pickImg');
  const imgDrop  = document.getElementById('imgDrop');
  const imgForm  = document.getElementById('imgForm');
  const imgCount = document.getElementById('imgCount');
  const imgLang  = document.getElementById('imgLang');

  // دوال مساعدة للّغة الحالية
  function getCurrentLang(){
    return localStorage.getItem('lang') || 'ar';
  }

  // نصوص العدّاد حسب اللغة
  const countTexts = {
    ar: {
      none: 'لا توجد صور محددة',
      some: n => `${n} صورة/صور محددة`
    },
    en: {
      none: 'No images selected',
      some: n => `${n} image(s) selected`
    },
    tr: {
      none: 'Seçili resim yok',
      some: n => `${n} resim seçildi`
    }
  };

  // نص رسالة التنبيه
  const alertTexts = {
    ar: 'اختر صور أولاً.',
    en: 'Please select images first.',
    tr: 'Lütfen önce resim seçin.'
  };

  // حط لغة الواجهة الحالية في الفورم (تروح للباكند)
  function syncLangField(){
    const lang = getCurrentLang();
    if (imgLang) imgLang.value = lang;
  }
  syncLangField();

  pickImg.onclick = ()=> imgs.click();

  ['dragenter','dragover'].forEach(ev=>{
    imgDrop.addEventListener(ev, e=>{
      e.preventDefault(); imgDrop.classList.add('drag');
    });
  });
  ['dragleave','drop'].forEach(ev=>{
    imgDrop.addEventListener(ev, e=>{
      e.preventDefault(); imgDrop.classList.remove('drag');
    });
  });

  imgDrop.addEventListener('drop', e=>{
    imgs.files = e.dataTransfer.files;
    updateCount();
  });

  imgs.addEventListener('change', updateCount);

  function updateCount(){
    const n = imgs.files?.length || 0;
    const lang = getCurrentLang();
    const t = countTexts[lang] || countTexts.ar;
    imgCount.textContent = n ? t.some(n) : t.none;
  }

  // استدعاء مرة أولى لتحديث النص حسب اللغة المحفوظة
  updateCount();

  imgForm.addEventListener('submit', (e)=>{
    if(!imgs.files?.length){
      e.preventDefault();
      const lang = getCurrentLang();
      alert(alertTexts[lang] || alertTexts.ar);
    } else {
      // تأكد أن الحقل المخفي محدث قبل الإرسال
      syncLangField();
    }
  });

  // في حال تغيّرت اللغة من الـ select في الهيدر (نفس المفتاح في localStorage)
  window.addEventListener('storage', (e)=>{
    if (e.key === 'lang'){
      syncLangField();
      updateCount();
    }
  });
</script>
{% endblock %}
