{% extends "base.html" %}
{% set active = 'img2pdf' %}

{% block content %}
<section class="hero">
  <div class="container">
    <h1>صور إلى PDF</h1>
    <p>ادمج صورك في ملف PDF واحد، أو أنشئ PDF لكل صورة. اختر النمط المناسب للجوال أو للطباعة.</p>
  </div>
</section>

<!-- روابط الميزات الأخرى -->
<div style="display:flex;gap:10px;justify-content:center;margin-bottom:12px">
  <a class="btn" href="/merge/pdf" style="background:#ef4444">دمج PDF</a>
</div>

<section>
  <div class="container">
    <div class="card">
      <form id="imgForm" action="/api/images-to-pdf" method="post" enctype="multipart/form-data"
            class="center" style="flex-direction:column;gap:12px">

        <!-- مُدخل الصور -->
        <input id="imgs" type="file" name="images" accept="image/*" multiple hidden />

        <div style="text-align:center">
          <button type="button" id="pickImg" class="btn">اختر الصور</button>
          <div class="sub">أو اسحبها هنا</div>
        </div>

        <div id="imgDrop" class="drop" style="max-width:720px">اسحب الصور هنا</div>

        <!-- الإعدادات -->
        <div class="row" style="justify-content:center;gap:10px;flex-wrap:wrap">
          <input type="text" name="outfile" value="images.pdf" placeholder="اسم ملف PDF (للدمج)">

          <select name="order" title="ترتيب">
            <option value="name">حسب الاسم (تصاعدي)</option>
            <option value="mtime">حسب تاريخ التعديل</option>
            <option value="as_is">كما تم اختيارها</option>
          </select>

          <label class="chip">
            <input type="checkbox" name="per_file" value="1"> ملف لكل صورة
          </label>

          <label class="chip">
            <input type="checkbox" name="compress" value="1"> ضغط خفيف للصور (أصغر حجم)
          </label>
        </div>

        <!-- نمط التخطيط -->
        <div class="row" style="justify-content:center;gap:14px;flex-wrap:wrap">
          <span class="sub" style="margin-inline-end:6px">النمط:</span>
          <label class="chip">
            <input type="radio" name="style" value="full_bleed" checked>
            مظهر للجوال (بدون حواف)
          </label>
          <label class="chip">
            <input type="radio" name="style" value="a4_margins">
            صفحة A4 بهوامش صغيرة (للطباعة)
          </label>
        </div>

        <div class="center" style="margin-top:6px;gap:10px;flex-wrap:wrap">
          <button type="submit" class="btn" style="font-size:16px">حوِّل الآن</button>
          <a class="btn" href="/" style="margin-inline-start:0">رجوع للصفحة الرئيسية</a>
        </div>

        <div id="imgCount" class="sub" style="text-align:center;margin-top:6px">
          لا توجد صور محددة
        </div>
      </form>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
  const imgs     = document.getElementById('imgs');
  const pickImg  = document.getElementById('pickImg');
  const imgDrop  = document.getElementById('imgDrop');
  const imgForm  = document.getElementById('imgForm');
  const imgCount = document.getElementById('imgCount');

  pickImg.onclick = () => imgs.click();

  ['dragenter','dragover'].forEach(ev=>{
    imgDrop.addEventListener(ev, e=>{ e.preventDefault(); imgDrop.classList.add('drag'); });
  });
  ['dragleave','drop'].forEach(ev=>{
    imgDrop.addEventListener(ev, e=>{ e.preventDefault(); imgDrop.classList.remove('drag'); });
  });
  imgDrop.addEventListener('drop', e=>{
    imgs.files = e.dataTransfer.files;
    updateCount();
  });
  imgs.addEventListener('change', updateCount);

  function updateCount(){
    const n = imgs.files?.length || 0;
    imgCount.textContent = n ? `${n} صورة/صور محددة` : 'لا توجد صور محددة';
  }

  imgForm.addEventListener('submit', (e)=>{
    if(!imgs.files?.length){
      e.preventDefault();
      alert('اختر صور أولاً.');
    }
  });
</script>
{% endblock %}
