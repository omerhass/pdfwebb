{% extends "base.html" %}
{% set active = 'img2pdf' %}

{% block content %}
<section class="hero">
  <div class="container">
    <h1>صور إلى PDF</h1>
    <p>ادمج صورك في ملف PDF واحد، أو أنشئ PDF لكل صورة مع ضبط تلقائي على صفحة A4.</p>
  </div>
</section>

<section>
  <div class="container">
    <div class="card">
      <form id="imgForm" action="/api/images-to-pdf" method="post" enctype="multipart/form-data" class="center" style="flex-direction:column;gap:12px">
        <!-- مُدخل الصور الفعلي -->
        <input id="imgs" type="file" name="images" accept="image/*" multiple hidden />

        <!-- زر اختيار الصور -->
        <div style="text-align:center">
          <button type="button" id="pickImg" class="btn">اختر الصور</button>
          <div class="sub">أو اسحبها هنا</div>
        </div>

        <!-- منطقة السحب والإفلات -->
        <div id="imgDrop" class="drop" style="max-width:720px">اسحب الصور هنا</div>

        <!-- خيارات الإخراج -->
        <div class="row" style="justify-content:center">
          <input type="text" name="outfile" value="images.pdf" placeholder="اسم ملف PDF (للدمج)">
          <select name="order" title="ترتيب">
            <option value="name">حسب الاسم (تصاعدي)</option>
            <option value="mtime">حسب تاريخ التعديل</option>
            <option value="as_is">كما تم اختيارها</option>
          </select>
          <label style="display:flex;align-items:center;gap:8px;">
            <input type="checkbox" name="per_file" value="1"> ملف لكل صورة
          </label>
          <label style="display:flex;align-items:center;gap:8px;">
            <input type="checkbox" name="fit_a4" value="1"> ضبط على A4
          </label>
        </div>

        <!-- إرسال -->
        <div class="center" style="margin-top:6px">
          <button type="submit" class="btn" style="font-size:16px">حوِّل الآن</button>
          <a class="btn" href="/" style="margin-inline-start:10px">رجوع للصفحة الرئيسية</a>
        </div>

        <!-- عدّاد -->
        <div id="imgCount" class="sub" style="text-align:center;margin-top:6px">لا توجد صور محددة</div>
      </form>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
  const imgs     = document.getElementById('imgs');
  const pickImg  = document.getElementById('pickImg');
  const imgDrop  = document.getElementById('imgDrop');
  const imgForm  = document.getElementById('imgForm');
  const imgCount = document.getElementById('imgCount');

  pickImg.onclick = ()=> imgs.click();

  ['dragenter','dragover'].forEach(ev=>{
    imgDrop.addEventListener(ev, e=>{ e.preventDefault(); imgDrop.classList.add('drag'); });
  });
  ['dragleave','drop'].forEach(ev=>{
    imgDrop.addEventListener(ev, e=>{ e.preventDefault(); imgDrop.classList.remove('drag'); });
  });
  imgDrop.addEventListener('drop', e=>{
    imgs.files = e.dataTransfer.files;
    updateCount();
  });
  imgs.addEventListener('change', updateCount);

  function updateCount(){
    const n = imgs.files?.length || 0;
    imgCount.textContent = n ? `${n} صورة/صور محددة` : 'لا توجد صور محددة';
  }

  imgForm.addEventListener('submit', (e)=>{
    if(!imgs.files?.length){
      e.preventDefault();
      alert('اختر صور أولاً.');
    }
  });
</script>
{% endblock %}
